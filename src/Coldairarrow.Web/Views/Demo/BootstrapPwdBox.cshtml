@{
    Layout = "~/Views/Shared/_Layout_Form.cshtml";
}

<div style="padding:15px;padding-right:45px;">
    <form id="form" class="form-horizontal" role="form">
        <div class="form-group form-group-sm">
            <label class="col-sm-2 control-label">密码</label>
            <div class="col-sm-5">
                <input id="Pwd" name="Pwd" style="display:none" type="text" class="form-control">
                <input id="Pwd_Show" type="text" class="form-control">
                <div class="help-block with-errors"></div>
            </div>
        </div>
        <div class="form-group">
            <button id="submit" type="submit" class="hidden">提交</button>
        </div>
    </form>
</div>
<script>
    $(function () {
        initEvent();
    });
    function getCursor(elem) {
        //IE 9 ，10，其他浏览器
        if (elem.selectionStart != undefined) {
            return elem.selectionStart;
        } else { //IE 6,7,8
            var range = document.selection.createRange();
            range.moveStart("character", -elem.value.length);
            var len = range.text.length;
            return len;
        }
    }
    //事件绑定
    function initEvent() {
        $('#Pwd_Show').bind('input propertychange', function () {
            console.log(getCursor(this));
            var real = $('#Pwd').val();
            var show = $(this).val();

            //if (real.length == 0) {
            //    real = show;
            //}
            //if (show.length == 0) {
            //    real = '';
            //    show = '';
            //}

            var reg = /(●*)([^●]*)(●*)/;
            reg.test(show);
            var showL1 = RegExp.$1;
            var showL2 = RegExp.$2;
            var showL3 = RegExp.$3;
            var realL1 = real.substring(0, showL1.length);
            var realL2 = showL2;
            var tmpL2 = Math.abs(showL2.length - Math.abs(show.length - real.length));
            var realL3 = real.substr(realL1.length + tmpL2, real.length - (realL1.length + tmpL2));
            real = realL1 + realL2 + realL3;

            show = real.replace(/./g, '●');
            $('#Pwd').val(real);
            $('#Pwd_Show').val(show);

            console.log('密码:' + real);
            console.log('显示:' + show);
        });
    }
</script>
