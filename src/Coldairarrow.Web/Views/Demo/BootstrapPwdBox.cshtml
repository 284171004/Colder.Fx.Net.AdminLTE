@{
    Layout = "~/Views/Shared/_Layout_Form.cshtml";
}

<div style="padding:15px;padding-right:45px;">
    <form id="form" class="form-horizontal" role="form">
        <div class="form-group form-group-sm">
            <label class="col-sm-2 control-label">密码</label>
            <div class="col-sm-5">
                <input id="Pwd" name="Pwd" style="display:none" type="text" class="form-control">
                <input id="Pwd_Show" type="text" class="form-control">
                <div class="help-block with-errors"></div>
            </div>
        </div>
        <div class="form-group">
            <button id="submit" type="submit" class="hidden">提交</button>
        </div>
    </form>
</div>
<script>
    $(function () {
        initEvent();
    });
    function getCursor(elem) {
        //IE 9 ，10，其他浏览器
        if (elem.selectionStart != undefined) {
            return elem.selectionStart;
        } else { //IE 6,7,8
            var range = document.selection.createRange();
            range.moveStart("character", -elem.value.length);
            var len = range.text.length;
            return len;
        }
    }
    // 设置光标位置
    function setCursor(textDom, pos) {
        if (textDom.setSelectionRange) {
            // IE Support
            textDom.focus();
            textDom.setSelectionRange(pos, pos);
        } else if (textDom.createTextRange) {
            // Firefox support
            var range = textDom.createTextRange();
            range.collapse(true);
            range.moveEnd('character', pos);
            range.moveStart('character', pos);
            range.select();
        }
    }
    //事件绑定
    function initEvent() {
        $('#Pwd_Show').bind('input propertychange', function () {
            var p = getCursor(this);
            console.log(p);
            var real = $('#Pwd').val();
            var show = $(this).val();

            var reg = /(●*)([^●]*)(●*)/;
            reg.test(show);

            var showL1 = RegExp.$1;
            var showL2 = RegExp.$2;
            var showL3 = RegExp.$3;

            //增加或替换
            if (showL2.length > 0) {
                var realL1 = real.substr(0, showL1.length);
                var realL2 = showL2;
                var realL3 = real.substr(real.length - showL3.length, showL3.length);
                real = realL1 + realL2 + realL3;
            } else {//仅删除
                var realL1 = real.substr(0, p);
                var realL2 = real.substr(p + (real.length - show.length));
                real = realL1 + realL2;
            }

            show = real.replace(/./g, '●');
            $('#Pwd').val(real);
            $('#Pwd_Show').val(show);
            setCursor(this, p);
        });
    }
</script>
